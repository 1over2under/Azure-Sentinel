[
  {
    "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', 'MyDataConnector')]",
    "apiVersion": "2022-12-01-preview",
    "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
    "location": "[parameters('workspace-location')]",
    "kind": "RestApiPoller",
    "properties": {
      "connectorDefinitionName": "[[parameters('connectorDefinitionName')]",
      "dcrConfig": {
        "streamName": "Custom-argsentdc_CL",
        "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
        "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
      },
      "dataType": "argsentdc_CL",
      "auth": {
        "type": "APIKey",
        "ApiKey": "[[parameters('apikey')]",
        "ApiKeyName": "Cookie",
        "ApiKeyIdentifier": "access_token="
      },
      "request": {
        "apiEndpoint": "[[concat('https://',parameters('domainname'),'.cyberint.io/alert/api/v1/alerts')]",
        "rateLimitQPS": 10,
        "queryWindowInMin": 5,
        "httpMethod": "POST",
        "queryTimeFormat": "UnixTimestamp",
        "retryCount": 3,
        "timeoutInSeconds": 60,
        "headers": {
          "Accept": "application/json",
          "User-Agent": "Scuba",
          "X-Sender-Id": "0",
          "X-Integration-Type": "Azure Sentinel",
          "X-Integration-Instance-Name": "Default",
          "X-Integration-Instance-Id": "0",
          "X-Integration-Customer-Name": "Integration",
          "X-Integration-Version": "1.0"
        },
        "isPostPayloadJson": true,
        "queryParametersTemplate": "{ 'filters': { 'created_date': { 'from': '{_QueryWindowStartTime}', 'to': '{_QueryWindowEndTime}' } } }"
      },
      "response": {
        "eventsJsonPaths": ["$.alerts"]
      }
    }
  }
]
