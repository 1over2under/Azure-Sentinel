{
  "name": "SalesForceServiceCloudCCPDefinition",
  "apiVersion": "2022-09-01-preview",
  "type": "Microsoft.SecurityInsights/dataConnectorDefinitions",
  "location": "{{location}}",
  "kind": "Customizable",
  "properties": {
    "connectorUiConfig": {
      "id": "SalesForceServiceCloudCCPDefinition",
      "title": "SalesForceServiceCloud (using REST API)",
      "publisher": "Microsoft",
      "descriptionMarkdown": "The SalesForceServiceCloud",
      "graphQueriesTableName": "SalesforceServiceCloud_CL",
      "graphQueries": [
        {
          "metricName": "Total events received",
          "legend": "Sophos Endpoint Protection Event logs",
          "baseQuery": "{{graphQueriesTableName}}"
        }
      ],
      "sampleQueries": [
        {
          "description": "Get a sample of Sophos Endpoint Protection Event logs",
          "query": "{{graphQueriesTableName}}\n| take 10"
        }
      ],
      "dataTypes": [
        {
          "name": "{{graphQueriesTableName}}",
          "lastDataReceivedQuery": "{{graphQueriesTableName}}\n|summarize Time = max  (TimeGenerated)\n|where isnotempty(Time)"
        }
      ],
      "connectivityCriteria": [
        {
          "type": "HasDataConnectors"
        }
      ],
      "permissions": {
        "resourceProvider": [
          {
            "provider": "Microsoft.OperationalInsights/workspaces",
            "permissionsDisplayText": "Read and Write permissions are required.",
            "providerDisplayName": "Workspace",
            "scope": "Workspace",
            "requiredPermissions": {
              "write": true,
              "read": true,
              "delete": true
            }
          }
        ],
        "customs": [
          {
            "name": "SalesforceServiceCloud_CL API access",
            "description": "Access to the SalesforceServiceCloud_CL API through a service principal is required."
          }
        ]
      },
      "instructionSteps": [
        {
          "description": "Follow .",
          "instructions": [
            {
              "type": "Textbox",
              "parameters": {
                "label": "Salesforce Domain Name",
                "required": true,
                "placeholder": "Salesforce Domain Name",
                "type": "text",
                "name": "salesforceDomainName"
              }
            },
            {
              "type": "Dropdown",
              "parameters": {
                "label": "Log Collection Interval",
                "name": "queryType",
                "required": true,
                "type": "text",
                "placeholder": "Select a Interval type",
                "options": [
                  {
                    "key": "SELECT Id,EventType,LogDate,Interval,CreatedDate,LogFile,LogFileLength FROM EventLogFile WHERE Interval='Hourly' and CreatedDate>{_QueryWindowStartTime} and CreatedDate<{_QueryWindowEndTime}",
                    "text": "Hourly"
                  },
                  {
                    "key": "SELECT Id,EventType,LogDate,CreatedDate,LogFile,LogFileLength FROM EventLogFile WHERE CreatedDate>{_QueryWindowStartTime} and CreatedDate<{_QueryWindowEndTime}",
                    "text": "Daily"
                  }
                ]
              }
            },
            {
              "type": "OAuthForm",
              "parameters": {
                "clientIdLabel": "Consumer Key",
                "clientSecretLabel": "Consumer Secret",
                "clientIdPlaceholder": "Enter Connected App Consumer Key",
                "clientSecretPlaceholder": "Enter Connected App Consumer Secret",
                "connectButtonLabel": "Connect",
                "disconnectButtonLabel": "Disconnect"
              }
            }
          ],
          "title": "Connect to SalesForce Service Cloud API to start collecting event and alert logs in Microsoft Sentinel"
        }
      ]
    }
  }
}