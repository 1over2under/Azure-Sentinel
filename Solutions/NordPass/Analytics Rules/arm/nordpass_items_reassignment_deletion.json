{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
      "workspace": {
          "type": "String"
      }
  },
  "resources": [
      {
          "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/0068dca4-dea0-46a3-a970-655e067a145f')]",
          "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/0068dca4-dea0-46a3-a970-655e067a145f')]",
          "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
          "kind": "Scheduled",
          "apiVersion": "2023-12-01-preview",
          "properties": {
              "displayName": "Deleting items of deleted member",
              "description": "This will alert you if the deleted user's items have been removed without being transferred to another active user, as this could result in the loss of access to critical tools or information.",
              "severity": "High",
              "enabled": true,
              "query": "NordPassEventLogs_CL\n| where event_type == \"item_delete\"\n| where action == \"item_reassignment_deleted\"\n| extend TargetEmail = user_email\n\n",
              "queryFrequency": "PT5M",
              "queryPeriod": "PT5M",
              "triggerOperator": "GreaterThan",
              "triggerThreshold": 0,
              "suppressionDuration": "PT5H",
              "suppressionEnabled": false,
              "startTimeUtc": null,
              "tactics": [
                  "Impact"
              ],
              "techniques": [
                  "T1485"
              ],
              "subTechniques": [],
              "alertRuleTemplateName": null,
              "incidentConfiguration": {
                  "createIncident": false,
                  "groupingConfiguration": {
                      "enabled": false,
                      "reopenClosedIncident": false,
                      "lookbackDuration": "PT5H",
                      "matchingMethod": "AllEntities",
                      "groupByEntities": [],
                      "groupByAlertDetails": [],
                      "groupByCustomDetails": []
                  }
              },
              "eventGroupingSettings": {
                  "aggregationKind": "SingleAlert"
              },
              "alertDetailsOverride": null,
              "customDetails": null,
              "entityMappings": [
                  {
                      "entityType": "Mailbox",
                      "fieldMappings": [
                          {
                              "identifier": "MailboxPrimaryAddress",
                              "columnName": "TargetEmail"
                          }
                      ]
                  }
              ],
              "sentinelEntitiesMappings": null,
              "templateVersion": null
          }
      }
  ]
}
