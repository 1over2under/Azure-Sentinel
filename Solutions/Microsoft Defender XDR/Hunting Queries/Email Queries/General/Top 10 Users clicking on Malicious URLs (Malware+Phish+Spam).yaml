id: 7d7a3d3f-22db-4cdf-ba67-c57215777a3c
name: Top 10 Users clicking on Malicious URLs (Malware+Phish+Spam)
description: |
  Identifies the top 10 users who clicked on URLs classified as malware, phishing, or spam.
  Note: Time Range is controlled by the portal's time picker.
  Based on concepts from the Defender for Office 365 solution in Sentinel: https://techcommunity.microsoft.com/blog/microsoftdefenderforoffice365blog/part-2-build-custom-email-security-reports-and-dashboards-with-workbooks-in-micr/4411303
requiredDataConnectors:
  - connectorId: MicrosoftThreatProtection
    dataTypes:
      - UrlClickEvents
tactics:
  - InitialAccess
relevantTechniques:
  - T1566
query: |
  UrlClickEvents
  | where ThreatTypes has "Malware" or ThreatTypes has "Phish" or ThreatTypes has "Spam"
  | summarize Count = count(), (Timestamp, NetworkMessageId) = arg_max(Timestamp, NetworkMessageId) by AccountUpn
  | top 10 by Count desc
version: 1.0.0