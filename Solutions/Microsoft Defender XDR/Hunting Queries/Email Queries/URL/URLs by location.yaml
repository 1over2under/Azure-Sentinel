id: ab006655-d723-4844-9d5d-91cb3b020555
name: URLs by location
description: |
  Summarizes URL locations in emails to help analysts track where links are most frequently found
  Note: Time range is controlled by the portal's time picker; uncomment the filter to focus on specific locations
  Based on Defender for Office 365 workbook: https://techcommunity.microsoft.com/blog/microsoftdefenderforoffice365blog/part-2-build-custom-email-security-reports-and-dashboards-with-workbooks-in-micr/4411303
requiredDataConnectors:
  - connectorId: MicrosoftThreatProtection
    dataTypes:
      - EmailUrlInfo
tactics:
  - InitialAccess
relevantTechniques:
  - T1566
query: |
  EmailUrlInfo
  // | where isnotempty(UrlLocation)  // Uncomment to exclude uncategorized locations
  | summarize Count = count(), (Timestamp, NetworkMessageId) = arg_max(Timestamp, NetworkMessageId) by UrlLocation
  | sort by Count desc
  // | top 10 by Count desc  // Uncomment or adjust N for summary/reporting use
version: 1.0.0