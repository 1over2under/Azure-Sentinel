[
  {
    "type": "Microsoft.SecurityInsights/dataConnectors",
    "apiVersion": "2022-10-01-preview",
    "name": "dataPoller",
    "kind": "RestApiPoller",
    "properties": {
      "connectorDefinitionName": "DragosSitestoreCCPDefinition",
      "dataType": "Dragos Sitestore Alerts",
      "dcrConfig": {
        "streamName": "Custom-DragosAlerts_CL"
      },
      "auth": {
        "type": "Basic",
        "UserName": "{{username}}",
        "Password": "{{password}}"
      },
      "request": {
        "apiEndpoint": "https://{{dragosSitestoreHostname}}/notifications/api/v2/notification",
        "rateLimitQPS": 15,
        "queryWindowInMin": 5,
        "httpMethod": "GET",
        "retryCount": 4,
        "timeoutInSeconds": 45,
        "headers": {
          "Accept": "application/json",
          "User-Agent": "MS-Sentinel-CCP-Dragos"
        },
        "queryParameters": {
          "sorts": "id:a",
          "filter": "[[concat('type!=''Baseline'';type!=''System'';createdAt=ge=''{_QueryWindowStartTime}'';createdAt=lt=''{_QueryWindowEndTime}'';severity>=', parameters('minSeverity'), ';severity<=', parameters('maxSeverity'))]"
        }
      },
      "response": {
        "eventsJsonPaths": [
          "$.content"
        ],
        "format": "json"
      },
      "paging": {
        "pagingType": "Offset",
        "pageSizeParameterName": "pageSize",
        
        // Paging setup for platform 2.5 and above using the offest param
        "pageSize": 25,
        "offsetParaName": "offset"

        // Paging setup for platform 2.4 and below. We want a page size of one
        // and the offset parameter name is simply the page size (i.e. we iterate
        // through with a page size of 1)
        //"pageSize": 1,
        //"offsetParaName": "pageNumber"
      }
    }
  }
]