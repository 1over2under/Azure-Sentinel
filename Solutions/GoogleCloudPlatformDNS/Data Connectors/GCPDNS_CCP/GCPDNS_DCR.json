[
    {
        "name": "GCPDNSDCR",
        "apiVersion": "2021-09-01-preview",
        "type": "Microsoft.Insights/dataCollectionRules",
        "location": "{{location}}",
        "properties": {
            "dataCollectionEndpointId": "{{dataCollectionEndpointId}}",
            "streamDeclarations": {
                "Custom-GCPDNS": {
                    "columns": [
                        {
                            "name": "insertId",
                            "type": "string"
                        },
                        {
                            "name": "logName",
                            "type": "string"
                        },
                        {
                            "name": "protoPayload",
                            "type": "dynamic"
                        },
                        {
                            "name": "resource",
                            "type": "dynamic"
                        },
                        {
                            "name": "severity",
                            "type": "string"
                        },
                        {
                            "name": "timestamp",
                            "type": "datetime"
                        },
                        {
                            "name": "jsonPayload",
                            "type": "dynamic"
                        },
                        {
                            "name": "TimeGenerated",
                            "type": "datetime"
                        }
                    ]
                }
            },
            "destinations": {
                "logAnalytics": [
                    {
                        "workspaceResourceId": "{{workspaceResourceId}}",
                        "name": "clv2ws1"
                    }
                ]
            },
            "dataFlows": [
                {
                    "streams": [
                        "Custom-GCPDNS"
                    ],
                    "destinations": [
                        "clv2ws1"
                    ],
                    "transformKql": "source | extend protoPayloadDynamic = parse_json(protoPayload), resourceDynamic = parse_json(resource), jsonPayloadDynamic = parse_json(jsonPayload), insert_id = insertId, log_name = logName, payload__type = tostring(protoPayloadDynamic['@type']), payload_authenticationInfo_principalEmail = tostring(protoPayloadDynamic['authenticationInfo']['principalEmail']), payload_authenticationInfo_principalSubject = tostring(protoPayloadDynamic['authenticationInfo']['principalSubject']), payload_authorizationInfo = tostring(protoPayloadDynamic['authorizationInfo']), payload_methodName = tostring(protoPayloadDynamic['methodName']), payload_request__type = tostring(protoPayloadDynamic['request']['@type']), payload_request_change_additions = tostring(protoPayloadDynamic['request']['change']['additions']), payload_request_change_deletions = tostring(protoPayloadDynamic['request']['change']['deletions']), payload_request_managedZone_description = tostring(protoPayloadDynamic['request']['managedZone']['description']), payload_request_managedZone_dnsName = tostring(protoPayloadDynamic['request']['managedZone']['dnsName']), payload_request_managedZone_name = tostring(protoPayloadDynamic['request']['managedZone']['name']), payload_request_managedZone = tostring(protoPayloadDynamic['request']['managedZone']), payload_request_managedZone_visibility = tostring(protoPayloadDynamic['request']['managedZone']['visibility']), payload_req_manZone_privVisibConfig_networks = tostring(protoPayloadDynamic['request']['managedZoneResource']['privateVisibilityConfig']['networks']), payload_request_name = tostring(protoPayloadDynamic['request']['name']), payload_request_project = tostring(protoPayloadDynamic['request']['project']), payload_request_type = tostring(protoPayloadDynamic['request']['@type']), payload_requestMetadata_callerIp = tostring(protoPayloadDynamic['requestMetadata']['callerIp']), payload_reqmeta_callerSuppliedUserAgent = tostring(protoPayloadDynamic['requestMetadata']['callerSuppliedUserAgent']), payload_reqmeta_requestAttributes_time = todatetime(protoPayloadDynamic['requestMetadata']['requestAttributes']['time']), payload_resourceName = tostring(protoPayloadDynamic['resourceName']), payload_response__type = tostring(protoPayloadDynamic['response']['@type']), payload_response_change_deletions = tostring(protoPayloadDynamic['response']['change']['deletions']), payload_response_change_id = tostring(protoPayloadDynamic['response']['change']['id']), payload_response_change_startTime = todatetime(protoPayloadDynamic['response']['change']['startTime']), payload_response_change_status = tostring(protoPayloadDynamic['response']['change']['status']), payload_response_managedZone_creationTime = todatetime(protoPayloadDynamic['response']['managedZone']['creationTime']), payload_response_managedZone_description = tostring(protoPayloadDynamic['response']['managedZone']['description']), payload_response_managedZone_dnsName = tostring(protoPayloadDynamic['response']['managedZone']['dnsName']), payload_response_managedZone_fingerprint = toguid(protoPayloadDynamic['response']['managedZone']['fingerprint']), payload_response_managedZone_id = tostring(protoPayloadDynamic['response']['managedZone']['id']), payload_response_managedZone_name = tostring(protoPayloadDynamic['response']['managedZone']['name']), payload_response_managedZone_nameServers = tostring(protoPayloadDynamic['response']['managedZone']['nameServers']), payload_resp_manZone_privVisibConfig_networks = tostring(protoPayloadDynamic['response']['managedZone']['privateVisibilityConfig']['networks']), payload_response_managedZone_rrsetCount = todouble(protoPayloadDynamic['response']['managedZone']['rrsetCount']), payload_response_managedZone_visibility = tostring(protoPayloadDynamic['response']['managedZone']['visibility']), payload_response_operation_id = toguid(protoPayloadDynamic['response']['operation']['id']), payload_response_operation_startTime = todatetime(protoPayloadDynamic['response']['operation']['startTime']), payload_response_operation_status = tostring(protoPayloadDynamic['response']['operation']['status']), payload_response_operation_type = tostring(protoPayloadDynamic['response']['operation']['type']), payload_response_operation_user = tostring(protoPayloadDynamic['response']['operation']['user']), payload_response_op_zoneContext_newValue = tostring(protoPayloadDynamic['response']['operation']['zoneContext']['newValue']), payload_response_op_zoneContext_oldValue = tostring(protoPayloadDynamic['response']['operation']['zoneContext']['oldValue']), payload_serviceName = tostring(protoPayloadDynamic['serviceName']), payload_status_code = todouble(protoPayloadDynamic['status']['code']), resource_labels_location = tostring(resourceDynamic['labels']['location']), resource_labels_project_id = tostring(resourceDynamic['labels']['project_id']), resource_labels_zone_name = tostring(resourceDynamic['labels']['zone_name']), resource_type = tostring(resourceDynamic['type']), payload_response_change_additions = tostring(protoPayloadDynamic['response']['change']['additions']), payload_req_manZone_cloudLogConfig_enableLogging = tobool(protoPayloadDynamic['request']['managedZone']['cloudLoggingConfig']['enableLogging']), payload_res_manZone_cloudLogConfig_enableLogging = tobool(protoPayloadDynamic['response']['managedZone']['cloudLoggingConfig']['enableLogging']), resource_labels_policy_name = tostring(resourceDynamic['labels']['policy_name']), resource_labels_target_type = tostring(resourceDynamic['labels']['target_type']), resource_labels_source_type = tostring(resourceDynamic['labels']['source_type']), resource_labels_target_name = tostring(resourceDynamic['labels']['target_name']), payload_vmProjectId = tostring(jsonPayloadDynamic['vmProjectId']), payload_protocol = tostring(jsonPayloadDynamic['protocol']), payload_queryType = tostring(jsonPayloadDynamic['queryType']), payload_rdata = tostring(jsonPayloadDynamic['rdata']), payload_vmInstanceId = todouble(jsonPayloadDynamic['vmInstanceId']), payload_vmInstanceIdString = tostring(jsonPayloadDynamic['vmInstanceIdString']), payload_vmInstanceName = tostring(jsonPayloadDynamic['vmInstanceName']), payload_responseCode = tostring(jsonPayloadDynamic['responseCode']), payload_authAnswer = tobool(jsonPayloadDynamic['authAnswer']), payload_queryName = tostring(jsonPayloadDynamic['queryName']), payload_vmZoneName = tostring(jsonPayloadDynamic['vmZoneName']), payload_sourceNetwork = tostring(jsonPayloadDynamic['sourceNetwork']), payload_serverLatency = todouble(jsonPayloadDynamic['serverLatency']), payload_sourceIP = tostring(jsonPayloadDynamic['sourceIP']), payload_destinationIP = tostring(jsonPayloadDynamic['destinationIP']), | project-away insertId, logName, protoPayload, resource, jsonPayload",
                    "outputStream": "Custom-GCP_DNSV2_CL"
                }
            ]
        }
    }
]