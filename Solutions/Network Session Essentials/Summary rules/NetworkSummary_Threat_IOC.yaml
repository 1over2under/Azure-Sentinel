id: 30716301-35c5-4f2b-9b55-2df178797b86
displayName: NetworkSummary_Threat_IP_Hosts
description: |
  'This summary rule aggregates recent network session data using the ASIM normalized _Im_NetworkSession function. It creates 20-minute summaries of sessions involving threat-related activity, grouped by source and destination IP addresses and hostnames. It focuses on sessions where a threat ID or category is present, helping identify potentially malicious communications between hosts.'
destinationTable: NetworkSummary_Threat_IOC_CL
query: |
  _Im_NetworkSession(starttime=bin(now(-20m), 20m), endtime=bin(now(), 20m))
  | where TimeGenerated < bin(nowTime,20m)
  | extend Threat = coalesce(ThreatId, ThreatName)
  | where isnotempty(Threat) or isnotempty(ThreatCategory)
  | summarize count() by SrcIpAddr, DstIpAddr, SrcHostname, DstHostname, bin(TimeGenerated, 20m)
  | extend EventTime = TimeGenerated
binSize: 20
version: 1.0.0