[
	{
		"name": "AWSCloudFront_DCR",
		"apiVersion": "2021-09-01-preview",
		"type": "Microsoft.Insights/dataCollectionRules",
		"location": "{{location}}",
		"kind": null,
		"properties": {
			"dataCollectionEndpointId": "{{dataCollectionEndpointId}}",
			"streamDeclarations": {
				"Custom-AwsCloudfront-AccessLog": {
					"columns": [
						{
							"name": "date",
							"type": "string"
						},
						{
							"name": "time",
							"type": "string"
						},
						{
							"name": "x-edge-location",
							"type": "string"
						},
						{
							"name": "sc-bytes",
							"type": "string"
						},
						{
							"name": "c-ip",
							"type": "string"
						},
						{
							"name": "cs-method",
							"type": "string"
						},
						{
							"name": "cs_Host",
							"type": "string"
						},
						{
							"name": "cs-uri-stem",
							"type": "string"
						},
						{
							"name": "sc-status",
							"type": "string"
						},
						{
							"name": "cs_Referer",
							"type": "string"
						},
						{
							"name": "cs_UserAgent",
							"type": "string"
						},
						{
							"name": "cs-uri-query",
							"type": "string"
						},
						{
							"name": "cs_Cookie",
							"type": "string"
						},
						{
							"name": "x-edge-result-type",
							"type": "string"
						},
						{
							"name": "x-edge-request-id",
							"type": "string"
						},
						{
							"name": "x-host-header",
							"type": "string"
						},
						{
							"name": "cs-protocol",
							"type": "string"
						},
						{
							"name": "cs-bytes",
							"type": "string"
						},
						{
							"name": "time-taken",
							"type": "string"
						},
						{
							"name": "x-forwarded-for",
							"type": "string"
						},
						{
							"name": "ssl-protocol",
							"type": "string"
						},
						{
							"name": "ssl-cipher",
							"type": "string"
						},
						{
							"name": "x-edge-response-result-type",
							"type": "string"
						},
						{
							"name": "cs-protocol-version",
							"type": "string"
						},
						{
							"name": "fle-status",
							"type": "string"
						},
						{
							"name": "fle-encrypted-fields",
							"type": "string"
						},
						{
							"name": "c-port",
							"type": "string"
						},
						{
							"name": "time-to-first-byte",
							"type": "string"
						},
						{
							"name": "x-edge-detailed-result-type",
							"type": "string"
						},
						{
							"name": "sc-content-type",
							"type": "string"
						},
						{
							"name": "sc-content-len",
							"type": "string"
						},
						{
							"name": "sc-range-start",
							"type": "string"
						},
						{
							"name": "sc-range-end",
							"type": "string"
						}
					]
				}
			},
			"destinations": {
				"logAnalytics": [
					{
						"workspaceResourceId": "{{workspaceResourceId}}",
						"name": "clv2ws1"
					}
				]
			},
			"dataFlows": [
				{
					"streams": [
						"Custom-AwsCloudfront-AccessLog"
					],
					"destinations": [
						"clv2ws1"
					],
					"transformKql": "source | extend TimeGenerated=todatetime(strcat(tostring(['date']), 'T', tostring(['time']))) | project TimeGenerated, XEdgeLocation=tostring(['x-edge-location']), ScBytes=tostring(['sc-bytes']), CIp=tostring(['c-ip']), CsMethod=tostring(['cs-method']), CsHost=tostring(cs_Host), CsUriStem=tostring(['cs-uri-stem']), ScStatus=tostring(['sc-status']), CsReferer=tostring(cs_Referer), CsUserAgent=tostring(cs_UserAgent), CsUriQuery=tostring(['cs-uri-query']), CsCookie=tostring('cs_Cookie'), XEdgeResultType=tostring(['x-edge-result-type']), XEdgeRequestId=tostring(['x-edge-request-id']), XHostHeader=tostring(['x-host-header']), CsProtocol=tostring(['cs-protocol']), CsBytes=tostring(['cs-bytes']), TimeTaken=tostring(['time-taken']), XForwardedFor=tostring(['x-forwarded-for']), SslProtocol=tostring(['ssl-protocol']), SslCipher=tostring(['ssl-cipher']), XEdgeResponseResultType=tostring(['x-edge-response-result-type']), CsProtocolVersion=tostring(['cs-protocol-version']), FleStatus=tostring(['fle-status']), FleEncryptedFields=tostring(['fle-encrypted-fields']), CPort=tostring(['c-port']), TimeToFirstByte=tostring(['time-to-first-byte']), XEdgeDetailedResultType=tostring(['x-edge-detailed-result-type']), ScContentType=tostring(['sc-content-type']), ScContentLen=tostring(['sc-content-len']), ScRangeStart=tostring(['sc-range-start']), ScRangeEnd=tostring(['sc-range-end'])",
					"outputStream": "Custom-AWSCloudFront_AccessLog_CL"
				}
			]
		}
	}
]