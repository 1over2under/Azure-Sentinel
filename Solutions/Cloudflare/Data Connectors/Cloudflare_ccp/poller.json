[
    {
        "name": "Cloudflare Logs Polling Config",
        "apiVersion": "2023-02-01-preview",
        "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
        "location": "{{location}}",
        "kind": "StorageAccountBlobContainer",
        "properties": {
            "connectorDefinitionName": "CloudflareDefinition",
            "dataType": "CloudflareLogsV2_CL",
            "dcrConfig": {
                "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]",
                "streamName": "Custom-CloudflareLogsV2CL"
            },
            "auth": {
                "type": "ServicePrincipal"
            },
            "response": {
                "eventsJsonPaths": [
                    "$"
                ],
                "format": "json",
                "isGzipCompressed": true
            },
            "request": {
                "QueueUri": "[[uri(concat('https://', variables('storageAccountName'), '.queue.core', '.windows.net', '/'), variables('queueName'))]",
                "DlqUri": "[[uri(concat('https://', variables('storageAccountName'), '.queue.core', '.windows.net', '/'), variables('dlqName'))]"
            }
        },
        "dependsOn": [
            "[[variables('nestedDeploymentId')]"
        ]
    }
]