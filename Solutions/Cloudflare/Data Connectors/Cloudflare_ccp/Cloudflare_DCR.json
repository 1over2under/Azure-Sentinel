[
    {
        "name": "CloudflareDCR",
        "apiVersion": "2021-09-01-preview",
        "type": "Microsoft.Insights/dataCollectionRules",
        "location": "{{location}}",
        "properties": {
            "dataCollectionEndpointId": "{{dataCollectionEndpointId}}",
            "streamDeclarations": {
                "Custom-CloudflarehttpLogsStream": {
                    "columns": [
                        {
                            "name": "TimeGenerated",
                            "type": "datetime"
                        },
                        {
                            "name": "BotDetectionIDs",
                            "type": "string"
                        },
                        {
                            "name": "BotDetectionTags",
                            "type": "string"
                        },
                        {
                            "name": "BotScore",
                            "type": "string"
                        },
                        {
                            "name": "BotScoreSrc",
                            "type": "string"
                        },
                        {
                            "name": "BotTags",
                            "type": "array"
                        },
                        {
                            "name": "CacheCacheStatus",
                            "type": "string"
                        },
                        {
                            "name": "CacheReserveUsed",
                            "type": "boolean"
                        },
                        {
                            "name": "CacheResponseBytes",
                            "type": "string"
                        },
                        {
                            "name": "CacheResponseStatus",
                            "type": "string"
                        },
                        {
                            "name": "CacheTieredFill",
                            "type": "boolean"
                        },
                        {
                            "name": "ClientASN",
                            "type": "string"
                        },
                        {
                            "name": "ClientCity",
                            "type": "string"
                        },
                        {
                            "name": "ClientCountry",
                            "type": "string"
                        },
                        {
                            "name": "ClientDeviceType",
                            "type": "string"
                        },
                        {
                            "name": "ClientIP",
                            "type": "string"
                        },
                        {
                            "name": "ClientIPClass",
                            "type": "string"
                        },
                        {
                            "name": "ClientLatitude",
                            "type": "string"
                        },
                        {
                            "name": "ClientLongitude",
                            "type": "string"
                        },
                        {
                            "name": "ClientMTLSAuthCertFingerprint",
                            "type": "string"
                        },
                        {
                            "name": "ClientMTLSAuthStatus",
                            "type": "string"
                        },
                        {
                            "name": "ClientRegionCode",
                            "type": "string"
                        },
                        {
                            "name": "ClientRequestBytes",
                            "type": "string"
                        },
                        {
                            "name": "ClientRequestHost",
                            "type": "string"
                        },
                        {
                            "name": "ClientRequestMethod",
                            "type": "string"
                        },
                        {
                            "name": "ClientRequestPath",
                            "type": "string"
                        },
                        {
                            "name": "ClientRequestProtocol",
                            "type": "string"
                        },
                        {
                            "name": "ClientRequestReferer",
                            "type": "string"
                        },
                        {
                            "name": "ClientRequestScheme",
                            "type": "string"
                        },
                        {
                            "name": "ClientRequestSource",
                            "type": "string"
                        },
                        {
                            "name": "ClientRequestURI",
                            "type": "string"
                        },
                        {
                            "name": "ClientRequestUserAgent",
                            "type": "string"
                        },
                        {
                            "name": "ClientSSLCipher",
                            "type": "string"
                        },
                        {
                            "name": "ClientSSLProtocol",
                            "type": "string"
                        },
                        {
                            "name": "ClientSrcPort",
                            "type": "string"
                        },
                        {
                            "name": "ClientTCPRTTMs",
                            "type": "string"
                        },
                        {
                            "name": "ClientXRequestedWith",
                            "type": "string"
                        },
                        {
                            "name": "ContentScanObjResults",
                            "type": "array"
                        },
                        {
                            "name": "ContentScanObjSizes",
                            "type": "array"
                        },
                        {
                            "name": "ContentScanObjTypes",
                            "type": "array"
                        },
                        {
                            "name": "Cookies",
                            "type": "array"
                        },
                        {
                            "name": "EdgeCFConnectingO2O",
                            "type": "boolean"
                        },
                        {
                            "name": "EdgeColoCode",
                            "type": "string"
                        },
                        {
                            "name": "EdgeColoID",
                            "type": "string"
                        },
                        {
                            "name": "EdgeEndTimestamp",
                            "type": "string"
                        },
                        {
                            "name": "EdgePathingOp",
                            "type": "string"
                        },
                        {
                            "name": "EdgePathingSrc",
                            "type": "string"
                        },
                        {
                            "name": "EdgePathingStatus",
                            "type": "string"
                        },
                        {
                            "name": "EdgeRequestHost",
                            "type": "string"
                        },
                        {
                            "name": "EdgeResponseBodyBytes",
                            "type": "string"
                        },
                        {
                            "name": "EdgeResponseBytes",
                            "type": "string"
                        },
                        {
                            "name": "EdgeResponseCompressionRatio",
                            "type": "string"
                        },
                        {
                            "name": "EdgeResponseContentType",
                            "type": "string"
                        },
                        {
                            "name": "EdgeResponseStatus",
                            "type": "string"
                        },
                        {
                            "name": "EdgeServerIP",
                            "type": "string"
                        },
                        {
                            "name": "EdgeStartTimestamp",
                            "type": "string"
                        },
                        {
                            "name": "EdgeTimeToFirstByteMs",
                            "type": "string"
                        },
                        {
                            "name": "JA3Hash",
                            "type": "string"
                        },
                        {
                            "name": "JA4",
                            "type": "string"
                        },
                        {
                            "name": "JA4Signals",
                            "type": "array"
                        },
                        {
                            "name": "LeakedCredentialCheckResult",
                            "type": "string"
                        },
                        {
                            "name": "OriginDNSResponseTimeMs",
                            "type": "string"
                        },
                        {
                            "name": "OriginIP",
                            "type": "string"
                        },
                        {
                            "name": "OriginRequestHeaderSendDurationMs",
                            "type": "string"
                        },
                        {
                            "name": "OriginResponseBytes",
                            "type": "string"
                        },
                        {
                            "name": "OriginResponseDurationMs",
                            "type": "string"
                        },
                        {
                            "name": "OriginResponseHTTPExpires",
                            "type": "string"
                        },
                        {
                            "name": "OriginResponseHTTPLastModified",
                            "type": "string"
                        },
                        {
                            "name": "OriginResponseHeaderReceiveDurationMs",
                            "type": "string"
                        },
                        {
                            "name": "OriginResponseStatus",
                            "type": "string"
                        },
                        {
                            "name": "OriginResponseTime",
                            "type": "string"
                        },
                        {
                            "name": "OriginSSLProtocol",
                            "type": "string"
                        },
                        {
                            "name": "OriginTCPHandshakeDurationMs",
                            "type": "string"
                        },
                        {
                            "name": "OriginTLSHandshakeDurationMs",
                            "type": "string"
                        },
                        {
                            "name": "ParentRayID",
                            "type": "string"
                        },
                        {
                            "name": "RayID",
                            "type": "string"
                        },
                        {
                            "name": "RequestHeaders",
                            "type": "array"
                        },
                        {
                            "name": "ResponseHeaders",
                            "type": "array"
                        },
                        {
                            "name": "SecurityAction",
                            "type": "string"
                        },
                        {
                            "name": "SecurityActions",
                            "type": "array"
                        },
                        {
                            "name": "SecurityRuleDescription",
                            "type": "string"
                        },
                        {
                            "name": "SecurityRuleID",
                            "type": "string"
                        },
                        {
                            "name": "SecurityRuleIDs",
                            "type": "array"
                        },
                        {
                            "name": "SecuritySources",
                            "type": "array"
                        },
                        {
                            "name": "SmartRouteColoID",
                            "type": "string"
                        },
                        {
                            "name": "UpperTierColoID",
                            "type": "string"
                        },
                        {
                            "name": "WAFAttackScore",
                            "type": "string"
                        },
                        {
                            "name": "WAFFlags",
                            "type": "string"
                        },
                        {
                            "name": "WAFMatchedVar",
                            "type": "string"
                        },
                        {
                            "name": "WAFRCEAttackScore",
                            "type": "string"
                        },
                        {
                            "name": "WAFSQLiAttackScore",
                            "type": "string"
                        },
                        {
                            "name": "WAFXSSAttackScore",
                            "type": "string"
                        },
                        {
                            "name": "WorkerCPUTime",
                            "type": "string"
                        },
                        {
                            "name": "WorkerScriptName",
                            "type": "string"
                        },
                        {
                            "name": "WorkerStatus",
                            "type": "string"
                        },
                        {
                            "name": "WorkerSubrequest",
                            "type": "boolean"
                        },
                        {
                            "name": "WorkerSubrequestCount",
                            "type": "string"
                        },
                        {
                            "name": "WorkerWallTimeUs",
                            "type": "string"
                        },
                        {
                            "name": "ZoneName",
                            "type": "string"
                        }
                    ]
                },
                "Custom-CloudflarednsLogsStream": {
                    "columns": [
                        {
                            "name": "ColoCode",
                            "type": "string"
                        },
                        {
                            "name": "EDNSSubnet",
                            "type": "string"
                        },
                        {
                            "name": "EDNSSubnetLength",
                            "type": "int"
                        },
                        {
                            "name": "QueryName",
                            "type": "string"
                        },
                        {
                            "name": "QueryType",
                            "type": "int"
                        },
                        {
                            "name": "ResponseCached",
                            "type": "bool"
                        },
                        {
                            "name": "ResponseCode",
                            "type": "int"
                        },
                        {
                            "name": "SourceIP",
                            "type": "string"
                        },
                        {
                            "name": "Timestamp",
                            "type": "datetime"
                        }
                    ]
                },
                "Custom-CloudflarefirewallLogsStream": {
                    "columns": [
                        {
                            "name": "Action",
                            "type": "string"
                        },
                        {
                            "name": "ClientASN",
                            "type": "int"
                        },
                        {
                            "name": "ClientASNDescription",
                            "type": "string"
                        },
                        {
                            "name": "ClientCountry",
                            "type": "string"
                        },
                        {
                            "name": "ClientIP",
                            "type": "string"
                        },
                        {
                            "name": "ClientIPClass",
                            "type": "string"
                        },
                        {
                            "name": "ClientRefererHost",
                            "type": "string"
                        },
                        {
                            "name": "ClientRefererPath",
                            "type": "string"
                        },
                        {
                            "name": "ClientRefererQuery",
                            "type": "string"
                        },
                        {
                            "name": "ClientRefererScheme",
                            "type": "string"
                        },
                        {
                            "name": "ClientRequestHost",
                            "type": "string"
                        },
                        {
                            "name": "ClientRequestMethod",
                            "type": "string"
                        },
                        {
                            "name": "ClientRequestPath",
                            "type": "string"
                        },
                        {
                            "name": "ClientRequestProtocol",
                            "type": "string"
                        },
                        {
                            "name": "ClientRequestQuery",
                            "type": "string"
                        },
                        {
                            "name": "ClientRequestScheme",
                            "type": "string"
                        },
                        {
                            "name": "ClientRequestUserAgent",
                            "type": "string"
                        },
                        {
                            "name": "ContentScanObjResults",
                            "type": "string"
                        },
                        {
                            "name": "ContentScanObjSizes",
                            "type": "int"
                        },
                        {
                            "name": "ContentScanObjTypes",
                            "type": "string"
                        },
                        {
                            "name": "Datetime",
                            "type": "string"
                        },
                        {
                            "name": "Description",
                            "type": "string"
                        },
                        {
                            "name": "EdgeColoCode",
                            "type": "string"
                        },
                        {
                            "name": "EdgeResponseStatus",
                            "type": "int"
                        },
                        {
                            "name": "Kind",
                            "type": "string"
                        },
                        {
                            "name": "LeakedCredentialCheckResult",
                            "type": "string"
                        },
                        {
                            "name": "MatchIndex",
                            "type": "int"
                        },
                        {
                            "name": "Metadata",
                            "type": "string"
                        },
                        {
                            "name": "OriginResponseStatus",
                            "type": "int"
                        },
                        {
                            "name": "OriginatorRayID",
                            "type": "string"
                        },
                        {
                            "name": "RayID",
                            "type": "string"
                        },
                        {
                            "name": "Ref",
                            "type": "string"
                        },
                        {
                            "name": "RuleID",
                            "type": "string"
                        },
                        {
                            "name": "Source",
                            "type": "string"
                        }
                    ]
                },
                "destinations": {
                    "logAnalytics": [
                        {
                            "workspaceResourceId": "{{workspaceResourceId}}",
                            "name": "clv2ws1"
                        }
                    ]
                },
                "dataFlows": [
                    {
                        "streams": [
                            "Custom-CloudflarehttpLogsStream"
                        ],
                        "destinations": [
                            "clv2ws1"
                        ],
                        "transformKql": "source | extend TimeGenerated = now ()| project TimeGenerated, BotDetectionIDs, BotDetectionTags, BotScore, BotScoreSrc, BotTags, CacheCacheStatus, CacheReserveUsed, CacheResponseBytes, CacheResponseStatus, CacheTieredFill, ClientASN, ClientCity, ClientCountry, ClientDeviceType, ClientIP, ClientIPClass, ClientLatitude, ClientLongitude, ClientMTLSAuthCertFingerprint, ClientMTLSAuthStatus, ClientRegionCode, ClientRequestBytes, ClientRequestHost, ClientRequestMethod, ClientRequestPath, ClientRequestProtocol, ClientRequestReferer, ClientRequestScheme, ClientRequestSource, ClientRequestURI, ClientRequestUserAgent, ClientSSLCipher, ClientSSLProtocol, ClientSrcPort, ClientTCPRTTMs, ClientXRequestedWith, ContentScanObjResults, ContentScanObjSizes, ContentScanObjTypes, Cookies, EdgeCFConnectingO2O, EdgeColoCode, EdgeColoID, EdgeEndTimestamp, EdgePathingOp, EdgePathingSrc, EdgePathingStatus, EdgeRequestHost, EdgeResponseBodyBytes, EdgeResponseBytes, EdgeResponseCompressionRatio, EdgeResponseContentType, EdgeResponseStatus, EdgeServerIP, EdgeStartTimestamp, EdgeTimeToFirstByteMs, JA3Hash, JA4, JA4Signals, LeakedCredentialCheckResult, OriginDNSResponseTimeMs, OriginIP, OriginRequestHeaderSendDurationMs, OriginResponseBytes, OriginResponseDurationMs, OriginResponseHTTPExpires, OriginResponseHTTPLastModified, OriginResponseHeaderReceiveDurationMs, OriginResponseStatus, OriginResponseTime, OriginSSLProtocol, OriginTCPHandshakeDurationMs, OriginTLSHandshakeDurationMs, ParentRayID, RayID, RequestHeaders, ResponseHeaders, SecurityAction, SecurityActions, SecurityRuleDescription, SecurityRuleID, SecurityRuleIDs, SecuritySources, SmartRouteColoID, UpperTierColoID, WAFAttackScore, WAFFlags, WAFMatchedVar, WAFRCEAttackScore, WAFSQLiAttackScore, WAFXSSAttackScore, WorkerCPUTime, WorkerScriptName, WorkerStatus, WorkerSubrequest, WorkerSubrequestCount, WorkerWallTimeUs, ZoneName",
                        "outputStream": "Custom-CloudflareV2_CL"
                    },
                    {
                        "streams": [
                            "Custom-CloudflarednsLogsStream"
                        ],
                        "destinations": [
                            "clv2ws1"
                        ],
                        "transformKql": "source | extend TimeGenerated = Timestamp | project ColoCode, EDNSSubnet, EDNSSubnetLength, QueryName, QueryType, ResponseCached, ResponseCode, SourceIP",
                        "outputStream": "Custom-CloudflareV2_CL"
                    },
                    {
                        "streams": [
                            "Custom-CloudflarefirewallLogsStream"
                        ],
                        "destinations": [
                            "clv2ws1"
                        ],
                        "transformKql": "source | extend TimeGenerated = Datetime | project Action, ClientASN, ClientASNDescription, ClientCountry, ClientIP, ClientIPClass, ClientRefererHost, ClientRefererPath, ClientRefererQuery, ClientRefererScheme, ClientRequestHost, ClientRequestMethod, ClientRequestPath, ClientRequestProtocol, ClientRequestQuery, ClientRequestScheme, ClientRequestUserAgent, ContentScanObjResults, ContentScanObjSizes, ContentScanObjTypes, Description, EdgeColoCode, EdgeResponseStatus, Kind, LeakedCredentialCheckResult, MatchIndex, Metadata, OriginResponseStatus, OriginatorRayID, RayID, Ref, RuleID, Source",
                        "outputStream": "Custom-CloudflareV2_CL"
                    }
                ]
            }
        }
    }
]