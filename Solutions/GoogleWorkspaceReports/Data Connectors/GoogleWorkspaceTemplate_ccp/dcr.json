[{
  "name": "GoogleWorkspaceDCR",
  "apiVersion": "2021-09-01-preview",
  "type": "Microsoft.Insights/dataCollectionRules",
  "location": "{{location}}",
  "properties": {
    "streamDeclarations": {
      "Custom-GoogleWorkspaceReports": {
        "columns": [
        { "name": "ACCOUNT_STATE", "type": "string" },
		{ "name": "actor_callerType", "type": "string" },
		{ "name": "actor_email", "type": "string" },
		{ "name": "actor_is_collaborator_account", "type": "boolean" },
		{ "name": "actor_key", "type": "string" },
		{ "name": "actor_profileId", "type": "string" },
		{ "name": "api_kind", "type": "string" },
		{ "name": "app_name", "type": "string" },
		{ "name": "APPLICATION_EDITION", "type": "string" },
		{ "name": "APPLICATION_NAME", "type": "string" },
		{ "name": "billable", "type": "boolean" },
		{ "name": "calendar_id", "type": "string" },
		{ "name": "client_id", "type": "string" },
		{ "name": "client_type", "type": "string" },
		{ "name": "destination_folder_id", "type": "string" },
		{ "name": "destination_folder_title", "type": "string" },
		{ "name": "doc_id", "type": "string" },
		{ "name": "doc_title", "type": "string" },
		{ "name": "doc_type", "type": "string" },
		{ "name": "USER_EMAIL", "type": "string" },
		{ "name": "recipient_email", "type": "string" },
		{ "name": "DEVICE_ID", "type": "string" },
		{ "name": "DEVICE_MODEL", "type": "string" },
		{ "name": "OS_VERSION", "type": "string" },
		{ "name": "DEVICE_TYPE", "type": "string" },
		{ "name": "etag", "type": "string" },
		{ "name": "kind", "type": "string" },
		{ "name": "end_time", "type": "string" },
		{ "name": "event_guest", "type": "string" },
		{ "name": "id_uniqueQualifier", "type": "string" },
		{ "name": "event_name", "type": "string" },
		{ "name": "events", "type": "string" },
		{ "name": "event_response_status", "type": "string" },
		{ "name": "start_time", "type": "string" },
		{ "name": "event_title", "type": "string" },
		{ "name": "event_type", "type": "string" },
		{ "name": "event_id", "type": "string" },
		{ "name": "ORG_UNIT_NAME", "type": "string" },
		{ "name": "id_applicationName", "type": "string" },
		{ "name": "IOS_VENDOR_ID", "type": "string" },
		{ "name": "is_second_factor", "type": "boolean" },
		{ "name": "is_suspicious", "type": "boolean" },
		{ "name": "LAST_SYNC_AUDIT_DATE", "type": "string" },
		{ "name": "login_challenge_method", "type": "string" },
		{ "name": "login_challenge_status", "type": "string" },
		{ "name": "login_type", "type": "string" },
		{ "name": "PRODUCT_NAME", "type": "string" },
		{ "name": "NEW_VALUE", "type": "string" },
		{ "name": "notification_message_id", "type": "string" },
		{ "name": "notification_method", "type": "string" },
		{ "name": "notification_type", "type": "string" },
		{ "name": "old_event_title", "type": "string" },
		{ "name": "OLD_VALUE", "type": "string" },
		{ "name": "old_visibility", "type": "string" },
		{ "name": "organizer_calendar_id", "type": "string" },
		{ "name": "originating_app_id", "type": "string" },
		{ "name": "OS_PROPERTY", "type": "string" },
		{ "name": "owner", "type": "string" },
		{ "name": "ownerDomain", "type": "string" },
		{ "name": "owner_is_shared_drive", "type": "boolean" },
		{ "name": "owner_is_team_drive", "type": "boolean" },
		{ "name": "primary_event", "type": "boolean" },
		{ "name": "SETTING_NAME", "type": "string" },
		{ "name": "REGISTER_PRIVILEGE", "type": "string" },
		{ "name": "RESOURCE_ID", "type": "string" },
		{ "name": "ROLE_NAME", "type": "string" },
		{ "name": "scope", "type": "string" },
		{ "name": "scope_data", "type": "string" },
		{ "name": "SERIAL_NUMBER", "type": "string" },
		{ "name": "shared_drive_id", "type": "string" },
		{ "name": "source_folder_id", "type": "string" },
		{ "name": "source_folder_title", "type": "string" },
		{ "name": "IPAddress", "type": "string" },
		{ "name": "target_calendar_id", "type": "string" },
		{ "name": "target_domain", "type": "string" },
		{ "name": "target_user", "type": "string" },
		{ "name": "team_drive_id", "type": "string" },
		{ "name": "id_customerId", "type": "string" },
		{ "name": "user_agent", "type": "string" },
		{ "name": "visibility", "type": "string" },
		{ "name": "visibility_change", "type": "string" }
        ]
      }
    },
    "destinations": {
      "logAnalytics": [
        {
          "workspaceResourceId": "{{workspaceResourceId}}",
          "name": "clv2ws1"
        }
      ]
    },
    "dataFlows": [
      {
        "streams": [
          "Custom-GoogleWorkspaceReports"
        ],
        "destinations": [
          "clv2ws1"
        ],   
		"transformKql": "source | extend TimeGenerated = todatetime(start_time), EventVendor=\"Google\", EventProduct=\"Google Workspace Activity Reports\" | extend AccountState=ACCOUNT_STATE | extend ActorCallerType=actor_callerType | extend ActorEmail=actor_email | extend ActorIsCollaboratorAccount=actor_is_collaborator_account | extend ActorKey=actor_key | extend ActorProfileId=actor_profileId | extend ApiKind=api_kind | extend AppName=app_name | extend ApplicationEdition=APPLICATION_EDITION | extend ApplicationName=APPLICATION_NAME | extend Billable=billable | extend CalendarId=calendar_id | extend ClientId=client_id | extend ClientType=client_type | extend DestinationFolderId=destination_folder_id | extend DestinationFolderTitle=destination_folder_title | extend DocId=doc_id | extend DocTitle=doc_title | extend DocType=doc_type | extend DstUserUpn=USER_EMAIL | extend DestUserUpn=recipient_email | extend DvcGuid=DEVICE_ID | extend DvcInterfaceGuid=DEVICE_ID | extend DvcModelName=DEVICE_MODEL | extend DvcModelNumber=OS_VERSION | extend DvcType=DEVICE_TYPE | extend Etag=etag  | extend EventEndTime=end_time | extend EventGuest=event_guest | extend EventId=id_uniqueQualifier | extend EventMessage=event_name | extend EventOriginalMessage=events | extend EventResponseStatus=event_response_status | extend EventStartTime=start_time | extend EventTitle=event_title | extend EventType=event_type | extend EventUid=event_id | extend GroupDomain=ORG_UNIT_NAME | extend IdApplicationName=id_applicationName | extend IosVendorId=IOS_VENDOR_ID | extend IosVendorUID=IOS_VENDOR_ID | extend IsSecondFactor=is_second_factor | extend IsSuspicious=is_suspicious | extend LastSyncAuditDate=LAST_SYNC_AUDIT_DATE | extend LoginChallengeMethod=login_challenge_method | extend LoginChallengeStatus=login_challenge_status | extend LoginType=login_type | extend ModuleName=PRODUCT_NAME | extend NeqValue=NEW_VALUE | extend NotificationMessageId=notification_message_id | extend NotificationMethod=notification_method | extend NotificationType=notification_type | extend OldEventTitle=old_event_title | extend OldValue=OLD_VALUE  | extend OldVisibility=old_visibility | extend OrganizerCalendarId=organizer_calendar_id | extend OriginatingAppId=originating_app_id | extend OsProperty=OS_PROPERTY | extend Owner=owner | extend OwnerDomain=ownerDomain | extend OwnerIsSharedDrive=owner_is_shared_drive | extend OwnerIsTeamDrive=owner_is_team_drive | extend PrimaryEvent=primary_event | extend ProcessName=SETTING_NAME | extend RegisterPrivelege=REGISTER_PRIVILEGE | extend ResourceId=RESOURCE_ID | extend RoleName=ROLE_NAME | extend Scope=scope | extend ScopeData=scope_data | extend SerialNumber=SERIAL_NUMBER | extend SharedDriveId=shared_drive_id | extend SourceFolderId=source_folder_id | extend SourceFolderTitle=source_folder_title | extend SrcIpAddr=IPAddress | extend TargetCalendarId=target_calendar_id | extend TargetUserDomain=target_domain | extend TargetUserName=target_user | extend TeamDriveId=team_drive_id | extend UserAadid=id_customerId | extend UserAgentOriginal=user_agent | extend UserEmail=USER_EMAIL | extend Visibility=visibility | extend VisibilityChange=visibility_change | project TimeGenerated, EventVendor, EventProduct, AccountState, ActorCallerType, ActorEmail, ActorIsCollaboratorAccount, ActorKey, ActorProfileId, ApiKind, AppName, ApplicationEdition, ApplicationName, Billable, CalendarId, ClientId, ClientType, DestinationFolderId, DestinationFolderTitle, DocId, DocTitle, DocType, DstUserUpn, DestUserUpn, DvcGuid, DvcInterfaceGuid, DvcModelName, DvcModelNumber, DvcType, Etag, EventEndTime, EventGuest, EventId, EventMessage, EventOriginalMessage, EventResponseStatus, EventStartTime, EventTitle, EventType, EventUid, GroupDomain, IdApplicationName, IosVendorId, IosVendorUID, IsSecondFactor, IsSuspicious, LastSyncAuditDate, LoginChallengeMethod, LoginChallengeStatus, LoginType, ModuleName, NeqValue,  NotificationMessageId, NotificationMethod, NotificationType, OldEventTitle, OldValue, OldVisibility, OrganizerCalendarId, OriginatingAppId, OsProperty, Owner, OwnerDomain, OwnerIsSharedDrive, OwnerIsTeamDrive, PrimaryEvent, ProcessName, RegisterPrivelege, ResourceId, RoleName, Scope, ScopeData, SerialNumber, SharedDriveId, SourceFolderId, SourceFolderTitle, SrcIpAddr, TargetCalendarId, TargetUserDomain, TargetUserName, TeamDriveId, UserAadid, UserAgentOriginal, UserEmail, Visibility, VisibilityChange",
        "outputStream": "Microsoft-GCPComputeEngine"
      }
    ]
  }
}]