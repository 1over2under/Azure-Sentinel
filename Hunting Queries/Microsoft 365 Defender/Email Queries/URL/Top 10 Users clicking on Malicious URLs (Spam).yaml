id: 3a2fdf32-ebe7-4f65-a1c3-fc7faf23ae90
name: Top 10 Users clicking on Malicious URLs (Spam)
description: |
  Identifies the top 10 users who clicked on URLs in emails categorized as spam to help analysts focus on users most exposed to unwanted content
  Note: Time range is controlled by the portal's time picker; uncomment the filter to focus only on spam verdicts
  Based on Defender for Office 365 workbook: https://techcommunity.microsoft.com/blog/microsoftdefenderforoffice365blog/part-2-build-custom-email-security-reports-and-dashboards-with-workbooks-in-micr/4411303
requiredDataConnectors:
  - connectorId: MicrosoftThreatProtection
    dataTypes:
      - UrlClickEvents
tactics:
  - InitialAccess
relevantTechniques:
  - T1566
query: |
  UrlClickEvents
  // | where ThreatTypes has "Spam"  // Uncomment to include only clicks on URLs categorized as spam
  | summarize ClickCount = count(), (Timestamp, NetworkMessageId) = arg_max(Timestamp, NetworkMessageId) by AccountUpn
  | sort by ClickCount desc
  | top 10 by ClickCount desc
version: 1.0.0