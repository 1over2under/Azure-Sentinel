id: ac738108-451b-4341-ba38-021a00665415
name: Blocked Clicks Trend
description: |
  Shows the daily trend of blocked URL click attempts in emails to help analysts visualize protection effectiveness over time
  Note: Uses a hardcoded 30-day time range for stable time-series visualization; choose the summarize-by-bin version for table output or make-series for charts with zero-filled gaps
  Based on Defender for Office 365 workbook: https://techcommunity.microsoft.com/blog/microsoftdefenderforoffice365blog/part-2-build-custom-email-security-reports-and-dashboards-with-workbooks-in-micr/4411303
requiredDataConnectors:
  - connectorId: MicrosoftThreatProtection
    dataTypes:
      - UrlClickEvents
tactics:
  - InitialAccess
relevantTechniques:
  - T1566
query: |
  let TimeStart = startofday(ago(30d));
  let TimeEnd = startofday(now());
  UrlClickEvents
  | where Timestamp >= TimeStart and Timestamp <= TimeEnd
  | where ActionType == "ClickBlocked"
  // Option 1: Table-friendly, readable output (recommended for most use cases)
  | summarize BlockedClicks = count() by bin(Timestamp, 1d)
  | order by Timestamp asc
  // | render timechart // Uncomment to display as a timechart
  // Option 2: Chart-friendly with zero-filled gaps (uncomment below and comment above for make-series)
  // | make-series BlockedCount = count() default=0 on Timestamp from TimeStart to TimeEnd step 1d
version: 1.0.0